!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cacheautocomplete=t():e.cacheautocomplete=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";function i(e){return e.replace(/([A-Z])/g,"-$1").replace(/^ms-/,"-ms-").toLowerCase()}function r(e){return"@"===e.charAt(0)}function o(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}function s(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString(36)}function a(e,t){return"number"!=typeof t||0===t||m[e]||(t+="px"),e+":"+String(t)}function u(e){return e.sort(function(e,t){return e[0]>t[0]?1:-1})}function c(e,n){for(var r=[],s=[],a=!1,c=0,h=Object.keys(e);c<h.length;c++){var l=h[c],d=e[l];l===t.IS_UNIQUE?a=!!d:o(d)?s.push([l.trim(),d]):r.push([i(l.trim()),d])}return{properties:u(r),nestedStyles:n?s:u(s),isUnique:a}}function h(e){for(var t=[],n=function(e,n){null!=n&&(Array.isArray(n)?n.forEach(function(n){n&&t.push(a(e,n))}):t.push(a(e,n)))},i=0,r=e;i<r.length;i++){var o=r[i];n(o[0],o[1])}return t.join(";")}function l(e,t){return e.indexOf("&")>-1?e.replace(/&/g,t):t+" "+e}function d(e,t,n,i,o){var s=c(n,!!t),a=s.properties,u=s.nestedStyles,f=s.isUnique,p=h(a),g=p;if(r(t)){var y=e.add(new L(t,o?void 0:p,e.hash));if(p&&o){var m=y.add(new k(p,y.hash,f?"u"+(++v).toString(36):void 0));i.push([o,m])}for(var _=0,S=u;_<S.length;_++){var I=S[_],x=I[0],b=I[1];g+=x+d(y,x,b,i,o)}}else{var w=o?l(t,o):t;if(p){var m=e.add(new k(p,e.hash,f?"u"+(++v).toString(36):void 0));i.push([w,m])}for(var C=0,P=u;C<P.length;C++){var T=P[C],x=T[0],b=T[1];g+=x+d(e,x,b,i,w)}}return g}function f(e,t,n,i,r){for(var o=new C(e.hash),s=[],a=d(o,t,n,s),u="f"+o.hash(a),c=r?r+"_"+u:u,h=0,f=s;h<f.length;h++){var p=f[h],g=p[0],y=p[1],v=i?l(g,"."+c):g;y.add(new P(v,y.hash,void 0,a))}return{cache:o,pid:a,id:c}}function p(e){return e.values().map(function(e){return e.getStyles()}).join("")}function g(e,t){return void 0===e&&(e=s),void 0===t&&(t=0),new T(e,t)}var y=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},v=0;t.IS_UNIQUE="__DO_NOT_DEDUPE_STYLE__";for(var m={"animation-iteration-count":!0,"box-flex":!0,"box-flex-group":!0,"column-count":!0,"counter-increment":!0,"counter-reset":!0,flex:!0,"flex-grow":!0,"flex-positive":!0,"flex-shrink":!0,"flex-negative":!0,"font-weight":!0,"line-clamp":!0,"line-height":!0,opacity:!0,order:!0,orphans:!0,"tab-size":!0,widows:!0,"z-index":!0,zoom:!0,"fill-opacity":!0,"stroke-dashoffset":!0,"stroke-opacity":!0,"stroke-width":!0},_=0,S=["-webkit-","-ms-","-moz-","-o-"];_<S.length;_++)for(var I=S[_],x=0,b=Object.keys(m);x<b.length;x++){var w=b[x];m[I+w]=!0}t.stringHash=s;var C=function(){function e(e){this.hash=e,this.changeId=0,this._children={},this._keys=[],this._counters={}}return e.prototype.values=function(){var e=this;return this._keys.map(function(t){return e._children[t]})},e.prototype.add=function(t){var n=this._counters[t.id]||0,i=this._children[t.id]||t.clone();if(this._counters[t.id]=n+1,0===n)this._keys.push(i.id),this._children[i.id]=i,this.changeId++;else{if(i.getIdentifier()!==t.getIdentifier())throw new TypeError("Hash collision: "+t.getStyles()+" === "+i.getStyles());if(this._keys.splice(this._keys.indexOf(t.id),1),this._keys.push(t.id),i instanceof e&&t instanceof e){var r=i.changeId;i.merge(t),i.changeId!==r&&this.changeId++}}return i},e.prototype.remove=function(t){var n=this._counters[t.id];if(n>0){this._counters[t.id]=n-1;var i=this._children[t.id];if(1===n)delete this._counters[t.id],delete this._children[t.id],this._keys.splice(this._keys.indexOf(t.id),1),this.changeId++;else if(i instanceof e&&t instanceof e){var r=i.changeId;i.unmerge(t),i.changeId!==r&&this.changeId++}}},e.prototype.merge=function(e){for(var t=0,n=e.values();t<n.length;t++){var i=n[t];this.add(i)}return this},e.prototype.unmerge=function(e){for(var t=0,n=e.values();t<n.length;t++){var i=n[t];this.remove(i)}return this},e.prototype.clone=function(){return new e(this.hash).merge(this)},e}();t.Cache=C;var P=function(){function e(e,t,n,i){void 0===n&&(n="s"+t(e)),void 0===i&&(i=""),this.selector=e,this.hash=t,this.id=n,this.pid=i}return e.prototype.getStyles=function(){return this.selector},e.prototype.getIdentifier=function(){return this.pid+"."+this.selector},e.prototype.clone=function(){return new e(this.selector,this.hash,this.id,this.pid)},e}();t.Selector=P;var k=function(e){function t(t,n,i){void 0===i&&(i="c"+n(t));var r=e.call(this,n)||this;return r.style=t,r.hash=n,r.id=i,r}return y(t,e),t.prototype.getStyles=function(){return this.values().map(function(e){return e.getStyles()}).join(",")+"{"+this.style+"}"},t.prototype.getIdentifier=function(){return this.style},t.prototype.clone=function(){return new t(this.style,this.hash,this.id).merge(this)},t}(C);t.Style=k;var L=function(e){function t(t,n,i,r,o){void 0===n&&(n=""),void 0===r&&(r="a"+i(t+"."+n)),void 0===o&&(o="");var s=e.call(this,i)||this;return s.rule=t,s.style=n,s.hash=i,s.id=r,s.pid=o,s}return y(t,e),t.prototype.getStyles=function(){return this.rule+"{"+this.style+p(this)+"}"},t.prototype.getIdentifier=function(){return this.pid+"."+this.rule+"."+this.style},t.prototype.clone=function(){return new t(this.rule,this.style,this.hash,this.id,this.pid).merge(this)},t}(C);t.Rule=L;var T=function(e){function t(t,n,i){void 0===i&&(i="f"+(++v).toString(36));var r=e.call(this,t)||this;return r.hash=t,r.debug=n,r.id=i,r}return y(t,e),t.prototype.registerStyle=function(e,t){var n=f(this,"&",e,!0,this.debug?t:void 0),i=n.cache,r=n.id;return this.merge(i),r},t.prototype.registerKeyframes=function(e,t){return this.registerHashRule("@keyframes",e,t)},t.prototype.registerHashRule=function(e,t,n){var i=f(this,"",t,!1,this.debug?n:void 0),r=i.cache,o=i.pid,s=i.id,a=new L(e+" "+s,void 0,this.hash,void 0,o);return this.add(a.merge(r)),s},t.prototype.registerRule=function(e,t){this.merge(f(this,e,t,!1).cache)},t.prototype.registerCss=function(e){this.merge(f(this,"",e,!1).cache)},t.prototype.getStyles=function(){return p(this)},t.prototype.getIdentifier=function(){return this.id},t.prototype.clone=function(){return new t(this.hash,this.debug,this.id).merge(this)},t}(C);t.FreeStyle=T,t.create=g},function(e,t,n){"use strict";function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return!!e}).join(" ")}function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},i=0,o=e;i<o.length;i++){var s=o[i];if(null!=s&&s!==!1)for(var a in s){var u=s[a];(u||0===u)&&("$nest"===a&&u?n[a]=n.$nest?r(n.$nest,u):u:a.indexOf("&")!==-1||0===a.indexOf("@media")?n[a]=n[a]?r(n[a],u):u:n[a]=u)}}return n}n.d(t,"d",function(){return o}),t.b=i,t.a=r,n.d(t,"c",function(){return s});var o="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame.bind(window),s=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=[];e.type&&i.push(e.type),e.orientation&&i.push(e.orientation),e.minWidth&&i.push("(min-width: "+e.minWidth+"px)"),e.maxWidth&&i.push("(max-width: "+e.maxWidth+"px)");var o="@media "+i.join(" and ");return{$nest:(s={},s[o]=r.apply(void 0,t),s)};var s}},function(e,t,n){"use strict";function i(e){var t=new r.a({autoGenerateTag:!1});return e&&t.setStylesTarget(e),t}Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(5);n.n(o);n.d(t,"types",function(){return o});var s=n(1);n.d(t,"extend",function(){return s.a}),n.d(t,"classes",function(){return s.b}),n.d(t,"media",function(){return s.c}),n.d(t,"setStylesTarget",function(){return u}),n.d(t,"cssRaw",function(){return c}),n.d(t,"cssRule",function(){return h}),n.d(t,"forceRenderStyles",function(){return l}),n.d(t,"fontFace",function(){return d}),n.d(t,"getStyles",function(){return f}),n.d(t,"keyframes",function(){return p}),n.d(t,"reinit",function(){return g}),n.d(t,"style",function(){return y}),t.createTypeStyle=i;var a=new r.a({autoGenerateTag:!0}),u=a.setStylesTarget,c=a.cssRaw,h=a.cssRule,l=a.forceRenderStyles,d=a.fontFace,f=a.getStyles,p=a.keyframes,g=a.reinit,y=a.style},function(e,t,n){"use strict";function i(e){var t={},n="";for(var r in e){var s=e[r];if("$unique"===r)t[o.IS_UNIQUE]=s;else if("$nest"===r){var a=s;for(var u in a){var c=a[u];t[u]=i(c).result}}else"$debugName"===r?n=s:t[r]=s}return{result:t,debugName:n}}function r(e){var t={$debugName:void 0,keyframes:{}};for(var n in e){var i=e[n];"$debugName"===n?t.$debugName=i:t.keyframes[n]=i}return t}var o=n(0);n.n(o);t.a=i,t.b=r},function(e,t,n){"use strict";var i=n(3),r=n(1),o=n(0);n.n(o);n.d(t,"a",function(){return s});var s=function(){function e(e){var t=e.autoGenerateTag,s=this;this.cssRaw=function(e){e&&(s._raw+=e||"",s._pendingRawChange=!0,s._styleUpdated())},this.cssRule=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var a=n.i(i.a)(r.a.apply(void 0,t)).result;s._freeStyle.registerRule(e,a),s._styleUpdated()},this.forceRenderStyles=function(){var e=s._getTag();e&&(e.textContent=s.getStyles())},this.fontFace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=s._freeStyle,i=0,r=e;i<r.length;i++){var o=r[i];n.registerRule("@font-face",o)}s._styleUpdated()},this.getStyles=function(){return(s._raw||"")+s._freeStyle.getStyles()},this.keyframes=function(e){var t=n.i(i.b)(e),r=t.keyframes,o=t.$debugName,a=s._freeStyle.registerKeyframes(r,o);return s._styleUpdated(),a},this.reinit=function(){var e=o.create();s._freeStyle=e,s._lastFreeStyleChangeId=e.changeId,s._raw="",s._pendingRawChange=!1;var t=s._getTag();t&&(t.textContent="")},this.setStylesTarget=function(e){s._tag&&(s._tag.textContent=""),s._tag=e,s.forceRenderStyles()},this.style=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=s._freeStyle,a=n.i(i.a)(r.a.apply(void 0,e)),u=a.result,c=a.debugName,h=c?o.registerStyle(u,c):o.registerStyle(u);return s._styleUpdated(),h};var a=o.create();this._autoGenerateTag=t,this._freeStyle=a,this._lastFreeStyleChangeId=a.changeId,this._pending=0,this._pendingRawChange=!1,this._raw="",this._tag=void 0}return e.prototype._afterAllSync=function(e){var t=this;this._pending++;var i=this._pending;n.i(r.d)(function(){i===t._pending&&e()})},e.prototype._getTag=function(){if(this._tag)return this._tag;if(this._autoGenerateTag){var e="undefined"==typeof window?{textContent:""}:document.createElement("style");return"undefined"!=typeof document&&document.head.appendChild(e),this._tag=e,e}},e.prototype._styleUpdated=function(){var e=this,t=this._freeStyle.changeId,n=this._lastFreeStyleChangeId;(this._pendingRawChange||t!==n)&&(this._lastFreeStyleChangeId=t,this._pendingRawChange=!1,this._afterAllSync(function(){return e.forceRenderStyles()}))},e}()},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e){var t=this;this.destroy=function(e){t.items.length>0&&(t.deleteItems(),t.removePopup())},this.rootElement=e.rootElement,this.queryUrl=e.queryUrl,this.itemTemplate=e.itemTemplate,this.templateKeys=e.templateKeys,this.items=[],this.cache=!e.cache||e.cache,this.minStringLength=e.minStringLength?e.minStringLength:1,this.itemClass=e.itemClass,this.listClass=e.listClass,this._POPUP=document.createElement("div"),this._LIST=document.createElement("ul"),this.itemSelect=e.itemSelect,this.createComponent()}return e.clearCache=function(e){if(e)localStorage.removeItem("CAC-"+e);else for(var t=localStorage.length;t--;){var n=localStorage.key(t);0===n.lastIndexOf("CAC",0)&&localStorage.removeItem(n)}},e.test=function(){console.log("test")},e.prototype.createComponent=function(){var e=this;this.rootElement.addEventListener("keydown",function(t){(9===t.keyCode||40===t.keyCode&&e.items.length>0)&&(t.preventDefault(),e._LIST.childNodes[0].focus())}),this.rootElement.addEventListener("keyup",function(t){var n=t.target;if(""===n.value)return e.deleteItems(),void e.removePopup();if(n.value.trim().length>=e.minStringLength){var i=e.queryUrl.replace("{{ value }}",encodeURIComponent(e.rootElement.value));e.get(i,!1).then(function(t){e.deleteItems(),t&&("string"==typeof t&&(t=JSON.parse(t)),e.setItems(t,e.itemTemplate),document.addEventListener("click",e.destroy),window.addEventListener("resize",e.destroy))},function(t){e.deleteItems(),e.setItems([{key:"No Matches"}],"<p> No Matches </p>",!0),document.addEventListener("click",e.destroy),window.addEventListener("resize",e.destroy)})}})},e.prototype.get=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise(function(i,r){for(var o=!1,s=localStorage.length;s--;){var a=localStorage.key(s);if(0===a.lastIndexOf("CAC",0)){a.indexOf(e)>-1===!0&&(o=!0)}if(o===!0)break}if(o&&t)n.http(e).then(function(t){n.cache&&n.cacheIt(e,t),i(t)},function(e){r(e)});else if(o&&!t){var u=localStorage.getItem("CAC-"+e);i(JSON.parse(u))}else o?r("get outta here"):n.http(e).then(function(t){n.cache&&n.cacheIt(e,t),i(t)},function(e){r(e)})})},e.prototype.setItems=function(e,t,n){void 0===n&&(n=!1),this.createListItems(e,t,n),this.stylePopup(),this._POPUP.appendChild(this._LIST),document.body.appendChild(this._POPUP),this._LIST.focus()},e.prototype.createListItems=function(e,t,n){var i=t,r=0;for(r;r<e.length;r++){var o=document.createElement("li");o.id=r.toString(),o.tabIndex=0,o.setAttribute("cacheautocomplete-id",r.toString());var s=i,a=void 0,u=0;for(u;u<this.templateKeys.length;u++){var c=this.templateKeys[u];if(s=s.replace("{{ "+c+" }}",""+e[r][c]),a=s,u===this.templateKeys.length-1){o.innerHTML=a,o.title=o.innerText;break}}this.styleListItem(o),n||this.setupListItemEventListeners(o,e),this.items.push(o),this._LIST.appendChild(o)}},e.prototype.styleListItem=function(e){if(this.itemClass)e.classList.add(this.itemClass);else{var t=i.style({color:"rgb(33, 33, 33)",cursor:"pointer",textOverflow:"ellipsis",height:"auto",padding:"0 15px",overflow:"hidden",whiteSpace:"nowrap",background:"transparent",transition:"background-color .15s linear",$nest:{"&:hover":{backgroundColor:"rgb(238,238,238)"},"&:focus":{outline:"none",backgroundColor:"#eeeeee",color:"#444"}}});e.classList.add(t)}},e.prototype.stylePopup=function(){this._LIST.setAttribute("style","list-style: none; padding: 0; margin: 0; max-height: 300px");var e=document.body.getBoundingClientRect(),t=this.rootElement.getBoundingClientRect(),n=(t.top,e.top,this.rootElement.clientHeight,t.left);if(this.listClass)this._POPUP.classList.add(this.listClass);else{var r=i.style({fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",backgroundColor:"#fff",borderRadius:"0",boxShadow:"0 1px 3px 0 rgba(0,0,0,.2), 0 1px 1px 0 rgba(0, 0, 0, .14), 0 2px 1px -1px rgba(0, 0, 0, .12)"});this._POPUP.classList.add(r)}var o=i.style({position:"absolute",left:Math.round(n).toString()+"px",zIndex:9999999,overflowY:"auto",maxHeight:"300px",width:this.rootElement.clientWidth.toString()+"px"});this._POPUP.classList.add(o)},e.prototype.setupListItemEventListeners=function(e,t){var n=this;e.addEventListener("keydown",function(i){var r=i.target;if(13===i.keyCode&&(n.removePopup(),n.itemSelect(t[parseInt(r.id,10)])),40===i.keyCode&&n.items.length>0){i.preventDefault();e.nextSibling;e.nextSibling&&"LI"===e.nextSibling.nodeName?e.nextSibling.focus():n._LIST.childNodes[0].focus()}38===i.keyCode&&n.items.length>0&&(i.preventDefault(),e.previousSibling&&"LI"===e.previousSibling.nodeName?e.previousSibling.focus():n.rootElement.focus())}),e.addEventListener("click",function(i){var r=e.getAttribute("cacheautocomplete-id");if(i.target&&r){var o=t[parseInt(r,10)];n.deleteItems(),n.removePopup(),n.itemSelect&&n.itemSelect(o)}})},e.prototype.deleteItems=function(){if(this._LIST.getElementsByTagName("li").length>0){for(;this._LIST.firstChild;)this._LIST.removeChild(this._LIST.firstChild);this.items=[]}},e.prototype.removePopup=function(){this._POPUP&&this._POPUP.parentNode&&this._POPUP.parentNode.removeChild(this._POPUP),document.removeEventListener("click",this.destroy),window.removeEventListener("resize",this.destroy)},e.prototype.cacheIt=function(e,t){localStorage&&localStorage.setItem("CAC-"+e,JSON.stringify(t))},e.prototype.http=function(e,t){return void 0===t&&(t="GET"),new Promise(function(n,i){var r=new XMLHttpRequest;r.open(t,e,!0),r.onloadend=function(){r.status>=200&&r.status<300?n(r.response):i(r.statusText)},r.send()})},e}();t.AutoComplete=r}])});
//# sourceMappingURL=cacheautocomplete.js.map