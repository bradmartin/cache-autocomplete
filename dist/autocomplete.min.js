"use strict";var CAComplete=function(){function t(t){var e=this;this.items=[],this.cache=!0,this.rootElement=t.rootElement,this.list=document.createElement("ul"),this.cache=t.cache,this.onItemSelect=t.onItemSelect,this.onItemsSet=t.onItemsSet,this.rootElement.addEventListener("keydown",function(t){9===t.keyCode&&e.items.length>0&&(t.preventDefault(),e.list.childNodes[0].focus()),40===t.keyCode&&e.items.length>0&&(t.preventDefault(),e.list.childNodes[0].focus())}),this.rootElement.addEventListener("keyup",function(o){var i=o.target;return""===i.value?(e.xItems(),void e.xPopup()):void(i.value.trim().length>=t.minStringLength&&(e.queryUrl=t.queryUrl.replace(t.wildCard,e.rootElement.value),e.get(e.queryUrl,!1).then(function(o){e.xItems(),"string"==typeof o&&(o=JSON.parse(o)),e.setItems(o,t.itemValue,t.listClass,t.itemClass)},function(o){e.xItems(),e.setItems([{key:"No Matches"}],"key",t.listClass,t.itemClass,!0)})))}),document.body.addEventListener("click",function(t){e.items.length>0&&(e.xItems(),e.xPopup())})}return t.prototype.clearCache=function(t){if(t)localStorage.removeItem("CAC-"+t);else for(var e=localStorage.length;e--;){var o=localStorage.key(e);0===o.lastIndexOf("CAC",0)&&localStorage.removeItem(o)}},t.prototype.get=function(t,e){var o=this;return void 0===e&&(e=!1),new Promise(function(i,n){for(var s=!1,l=localStorage.length;l--;){var r=localStorage.key(l);if(0===r.lastIndexOf("CAC",0)){var a=r.indexOf(t)>-1;a===!0&&(s=!0)}if(s===!0)break}if(s&&e)o.http(t).then(function(e){o.cache&&o.cacheIt(t,e),i(e)},function(t){n(t)});else if(s&&!e){var c=localStorage.getItem("CAC-"+t);i(JSON.parse(c))}else s?n("get outta here"):o.http(t).then(function(e){o.cache&&o.cacheIt(t,e),i(e)},function(t){n(t)})})},t.prototype.setItems=function(t,e,o,i,n){var s=this;void 0===n&&(n=!1);for(var l=function(o){var l=document.createElement("li");l.id=t.indexOf(t[o]).toString(),l.tabIndex=0,l.innerHTML=""+t[o][e],l.classList.add(i),n||(l.addEventListener("keydown",function(o){var i=o.target;if(13===o.keyCode){var n=t[parseInt(i.id,10)];s.rootElement.value=n[e],s.xPopup(),s.onItemSelect(n)}if(40===o.keyCode&&s.items.length>0){o.preventDefault();var r=l.nextSibling;r?"li"===r.nodeName.toLowerCase()&&r.focus():s.list.childNodes[0].focus()}if(38===o.keyCode&&s.items.length>0){o.preventDefault();var a=l.previousSibling;a?"li"===a.nodeName.toLowerCase()&&a.focus():s.rootElement.focus()}}),l.addEventListener("click",function(o){var i=o.target;if(i&&"li"===i.nodeName.toLowerCase()){var n=t[parseInt(i.id,10)];s.rootElement.value=n[e],s.xItems(),s.xPopup(),s.onItemSelect&&s.onItemSelect(n)}})),r.items.push(l),r.list.appendChild(l)},r=this,a=0;a<t.length;a++)l(a);Object.assign(this.list.style,{listStyle:"none",padding:"0",margin:"0"}),this.popup||(this.popup=document.createElement("div")),this.popup.classList.add(o),Object.assign(this.popup.style,{position:"absolute",zIndex:"999999999",overflowY:"auto",maxHeight:"300px",width:this.rootElement.clientWidth.toString()+"px"}),this.popup.appendChild(this.list),this.rootElement.parentNode.insertBefore(this.popup,this.rootElement.nextSibling),this.list.focus(),this.onItemsSet&&this.onItemsSet()},t.prototype.xItems=function(){if(this.list.getElementsByTagName("li").length>0){for(;this.list.firstChild;)this.list.removeChild(this.list.firstChild);this.items=[]}},t.prototype.xPopup=function(){this.popup&&this.popup.parentNode.removeChild(this.popup)},t.prototype.cacheIt=function(t,e){localStorage&&localStorage.setItem("CAC-"+t,JSON.stringify(e))},t.prototype.http=function(t,e){return void 0===e&&(e="GET"),new Promise(function(o,i){var n=new XMLHttpRequest;n.open(e,t,!0),n.onload=function(){n.status>=200&&n.status<300?o(n.response):i(n.statusText)},n.onerror=function(){i(n.statusText)},n.send()})},t}();exports.CAComplete=CAComplete;